# Exercise 4: Understanding actionable messages

## Task 1: Modify an existing adaptive card using the Card Playground

1. Open the Actionable Message Designer in the browser. [https://amdesigner.azurewebsites.net/](https://amdesigner.azurewebsites.net/)

1. Choose a predefined design such as Expense Approval.

    ![Choose a pre-defined design](../../Linked_Image_Files/understanding_actionable_messages_image_1.png)

1. Select each control to get familiar with the properties and then update some of the properties such as the text displayed. Update the card’s design as desired and then preview the card by selecting **Preview**.

    ![Update card design](../../Linked_Image_Files/understanding_actionable_messages_image_2.png)

1. Test the button to see the HTTP request by selecting the **Accept** button.

    ![Accept button](../../Linked_Image_Files/understanding_actionable_messages_image_3.png)

1. To exit the preview, select **Edit Preview**.

![Edit Preview button](../../Linked_Image_Files/understanding_actionable_messages_image_4.png)

### Send updated adaptive card

1. Send the adaptive card as a test email by selecting **Send**.

1. If prompted for credentials, sign in with the Office 365 account you are using for this lab. When prompted for consent, accept.

1. Check email to see if the adaptive card has been sent and is displaying successfully.

## Task 2: Create an actionable message card from scratch

Now that you’re familiar with the Card Playground, move on to the next steps in this task to create an actionable message card. We'll start with something simple, just a basic card with an `Action.Http` action and an `Action.OpenUrl` action.

The sample card markup in this topic omits the originator property. This works in a testing scenario, where the recipient is the same as the sender. When sending actionable messages to anyone else, the originator property must be set to a valid provider ID generated by the [Actionable Email Developer Dashboard](https://docs.microsoft.com/en-us/outlook/actionable-messages/email-dev-dashboard). Leaving this property empty when sending to others results in the card being removed.

1. Go to the Card Playground and paste in the following JSON:

    ```json
    {
        "type": "AdaptiveCard",
        "version": "1.0",
        "body": [
            {
                "type": "TextBlock",
                "text": "Visit the Outlook Dev Portal",
                "size": "large"
            },
            {
                    "type": "TextBlock",
                    "text": "Click **Learn More** to learn more about Actionable Messages!"
            },
            {
                "type": "Input.Text",
                "id": "feedbackText",
                "placeholder": "Let us know what you think about Actionable Messages"
            }
        ],
        "actions": [
            {
                "type": "Action.Http",
                "title": "Send Feedback",
                "method": "POST",
                "url": "https://...",
                "body": "{{feedbackText.value}}"
            },
            {
                "type": "Action.OpenUrl",
                "title": "Learn More",
                "url": "https://docs.microsoft.com/outlook/actionable-messages"
            }
        ]
    }
    ```

1. Feel free to experiment with this simple example in the playground. You can see the [adaptive card reference](https://docs.microsoft.com/en-us/outlook/actionable-messages/adaptive-card) for details on the available fields. Once you have a card you're happy with, you can move on to sending it.

### Sending actionable messages via email

You can design and test actionable messages by using the [Card Playground](https://messagecardplayground.azurewebsites.net/), which allows you to send actionable messages to yourself. You can also send actionable messages to yourself using the [Office 365 SMTP server](https://support.office.com/article/pop-and-imap-email-settings-for-outlook-8361e398-8af4-4e97-b147-6c6c4ac95353). You will be unable to send actionable messages to any other user until you have registered using the [actionable messages developer dashboard](https://aka.ms/publishoam).

To embed an actionable message card in an email message, you need to wrap the card in a `<script>` tag, inserted into the `<head>` of the email's HTML body.

**Note**:
Because the card JSON must be wrapped in a `<script>` tag, the body of the actionable message email MUST be HTML. Plain text messages are not supported.

1. Add the **hideOriginalBody** attribute to control what happens with the body of the email. In this case we'll set the attribute to true so that the body will not be shown.

    ```json
    {
        "type": "AdaptiveCard",
        "version": "1.0",
        "hideOriginalBody": true,
        "body": [
            {
                "type": "TextBlock",
                "text": "Visit the Outlook Dev Portal",
                "size": "large"
            },
            {
                    "type": "TextBlock",
                    "text": "Click **Learn More** to learn more about Actionable Messages!"
            },
            {
                "type": "Input.Text",
                "id": "feedbackText",
                "placeholder": "Let us know what you think about Actionable Messages"
            }
        ],
        "actions": [
            {
                "type": "Action.Http",
                "title": "Send Feedback",
                "method": "POST",
                "url": "https://...",
                "body": "{{feedbackText.value}}"
            },
            {
                "type": "Action.OpenUrl",
                "title": "Learn More",
                "url": "https://docs.microsoft.com/outlook/actionable-messages"
            }
        ]
    }
    ```

1. Wrap the resulting JSON in a `<script>` tag of type `application/adaptivecard+json`. If you are using the [legacy message card format](https://docs.microsoft.com/en-us/outlook/actionable-messages/message-card-reference) rather than the Adaptive card format, the `<script>` tag type MUST be `application/ld+json`.

    ```json
    <script type="application/adaptivecard+json">{
        "type": "AdaptiveCard",
        "version": "1.0",
        "hideOriginalBody": true,
        "body": [
            {
                "type": "TextBlock",
                "text": "Visit the Outlook Dev Portal",
                "size": "large"
            },
            {
                    "type": "TextBlock",
                    "text": "Click **Learn More** to learn more about Actionable Messages!"
            },
            {
                "type": "Input.Text",
                "id": "feedbackText",
                "placeholder": "Let us know what you think about Actionable Messages"
            }
        ],
        "actions": [
            {
                "type": "Action.Http",
                "title": "Send Feedback",
                "method": "POST",
                "url": "https://...",
                "body": "{{feedbackText.value}}"
            },
            {
                "type": "Action.OpenUrl",
                "title": "Learn More",
                "url": "https://docs.microsoft.com/outlook/actionable-messages"
            }
        ]
    }
    </script>
    ```

1. Generate an HTML document to represent the email body and include the `<script>` tag in the `<head`>.

    ```html
    <html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <script type="application/adaptivecard+json">{
            "type": "AdaptiveCard",
            "version": "1.0",
            "hideOriginalBody": true,
            "body": [
                {
                    "type": "TextBlock",
                    "text": "Visit the Outlook Dev Portal",
                    "size": "large"
                },
                {
                    "type": "TextBlock",
                    "text": "Click **Learn More** to learn more about Actionable Messages!"
                },
                {
                    "type": "Input.Text",
                    "id": "feedbackText",
                    "placeholder": "Let us know what you think about Actionable Messages"
                }
            ],
            "actions": [
                {
                    "type": "Action.Http",
                    "title": "Send Feedback",
                    "method": "POST",
                    "url": "https://...",
                    "body": "{{feedbackText.value}}"
                },
                {
                    "type": "Action.OpenUrl",
                    "title": "Learn More",
                    "url": "https://docs.microsoft.com/outlook/actionable-messages"
                }
            ]
        }
        </script>
    </head>
    <body>
    Visit the <a href="https://docs.microsoft.com/outlook/actionable-messages">Outlook Dev Portal</a> to learn more about Actionable Messages.
    </body>
    </html>
    ```

1. Send a message via SMTP with the HTML as the body.

### Sending the message

For examples of sending messages, see the following.

[Send Actionable Message via [Microsoft Graph](https://docs.microsoft.com/en-us/graph/overview)](https://github.com/jasonjoh/send-actionable-message): A sample console app written in C# that sends an actionable message using Microsoft Graph.
[Send Actionable Message via SMTP](https://github.com/tony-zhu/SendActionableMessage): A sample Python script that sends an actionable message using the Office 365 SMTP server. It also includes a sample HTML payload for the actionable message email body.
### Performing actions

For examples of performing actions, see the following.

[Hello Actionable Messages](https://github.com/OfficeDev/HelloActionableMessages): A sample project with one-click button Azure deployment. This sample is a simple end-to-end actionable message solution that can be up and working within 10 minutes, and serves as a reference for building a production action endpoint.
### Troubleshooting tools

[Actionable Messages Debugger](https://appsource.microsoft.com/product/office/WA104381686): An Outlook add-in that allows developers to inspect the card payload in their actionable messages and identify why the card is not rendering.
## Task 3: Post an actionable message card to an Office 365 group

### Create an actionable message card

Let's start by creating an actionable message card. We'll start with a basic card with an `HttpPOST` action and an `OpenUri` action. We'll use the Card Playground to design the card.

1. Go to Card Playground located at [https://messagecardplayground.azurewebsites.net/](https://messagecardplayground.azurewebsites.net/) and paste in the following JSON:

    ```json
    {
        "@context": "https://schema.org/extensions",
        "@type": "MessageCard",
        "themeColor": "0072C6",
        "title": "Visit the Outlook Dev Portal",
        "text": "Click **Learn More** to learn more about Actionable Messages!",
        "potentialAction": [
            {
                "@type": "ActionCard",
                "name": "Send Feedback",
                "inputs": [
                    {
                      "@type": "TextInput",
                      "id": "feedback",
                      "isMultiline": true,
                      "title": "Let us know what you think about Actionable Messages"
                    }
                ],
                "actions": [
                    {
                        "@type": "HttpPOST",
                        "name": "Send Feedback",
                        "isPrimary": true,
                        "target": "http://..."
                    }
                ]
            },
            {
                "@type": "OpenUri",
                "name": "Learn More",
                "targets": [
                    { "os": "default", "uri": "https://docs.microsoft.com/outlook/actionable-messages" }
                ]
            }
        ]
    }
    ```

1. Feel free to experiment with this simple example in the playground. You can see the message card reference ([https://docs.microsoft.com/en-us/outlook/actionable-messages/message-card-reference](https://docs.microsoft.com/en-us/outlook/actionable-messages/message-card-reference)) for details on the available fields. Once you have a card you're happy with, you can move on to sending it.

